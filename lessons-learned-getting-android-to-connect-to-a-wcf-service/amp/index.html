<!doctype html>
<html amp lang="en-US">

<!-- Mirrored from www.bluelabellabs.com/lessons-learned-getting-android-to-connect-to-a-wcf-service/amp/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 Nov 2018 06:31:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
		<title>Lessons learned: Getting Android to connect to a WCF service</title>
		<link rel="canonical" href="../index.html"/>
	<script type='text/javascript' src='../../../cdn.ampproject.org/v0.js' async></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic"><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>	<script type="application/ld+json">{"@context":"http:\/\/schema.org","publisher":{"@type":"Organization","name":"Blue Label Labs","logo":{"@type":"ImageObject","url":"https:\/\/www.bluelabellabs.com\/wp-content\/uploads\/2018\/08\/android-chrome-256x256-120x120.png","height":32,"width":32}},"@type":"BlogPosting","mainEntityOfPage":"https:\/\/www.bluelabellabs.com\/lessons-learned-getting-android-to-connect-to-a-wcf-service\/","headline":"Lessons learned: Getting Android to connect to a WCF service","datePublished":"2011-04-19T15:17:51+00:00","dateModified":"2011-04-19T15:17:51+00:00","author":{"@type":"Person","name":"Bobby Gill"},"image":{"@type":"ImageObject","url":"https:\/\/www.bluelabellabs.com\/wp-content\/uploads\/2011\/04\/icon-1971128_1920.png","width":1920,"height":1920}}</script>
	<meta name="generator" content="AMP Plugin v0.7.2"/>	<style amp-custom>.alignright{float:right}.alignleft{float:left}.aligncenter{display:block;margin-left:auto;margin-right:auto}.amp-wp-enforced-sizes{max-width:100%;margin:0 auto}.amp-wp-unknown-size img{object-fit:contain}.amp-wp-content,.amp-wp-title-bar div{margin:0 auto;max-width:900px}html{background:#0a89c0}body{background:#fff;color:#353535;font-family:'Merriweather','Times New Roman',Times,serif;font-weight:300;line-height:1.75em}p,ol,ul,figure{margin:0 0 1em;padding:0}a,a:visited{color:#0a89c0}a:hover,a:active,a:focus{color:#353535}blockquote{color:#353535;background:rgba(127,127,127,.125);border-left:2px solid #0a89c0;margin:8px 0 24px 0;padding:16px}blockquote p:last-child{margin-bottom:0}.amp-wp-meta,.amp-wp-header div,.amp-wp-title,.wp-caption-text,.amp-wp-tax-category,.amp-wp-tax-tag,.amp-wp-comments-link,.amp-wp-footer p,.back-to-top{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen-Sans","Ubuntu","Cantarell","Helvetica Neue",sans-serif}.amp-wp-header{background-color:#0a89c0}.amp-wp-header div{color:#fff;font-size:1em;font-weight:400;margin:0 auto;max-width:calc(840px - 32px);padding:.875em 16px;position:relative}.amp-wp-header a{color:#fff;text-decoration:none}.amp-wp-header .amp-wp-site-icon{background-color:#fff;border:1px solid #fff;border-radius:50%;position:absolute;right:18px;top:10px}.amp-wp-article{color:#353535;font-weight:400;margin:1.5em auto;max-width:840px;overflow-wrap:break-word;word-wrap:break-word}.amp-wp-article-header{align-items:center;align-content:stretch;display:flex;flex-wrap:wrap;justify-content:space-between;margin:1.5em 16px 0}.amp-wp-title{color:#353535;display:block;flex:1 0 100%;font-weight:900;margin:0 0 .625em;width:100%}.amp-wp-meta{color:#696969;display:inline-block;flex:2 1 50%;font-size:.875em;line-height:1.5em;margin:0 0 1.5em;padding:0}.amp-wp-article-header .amp-wp-meta:last-of-type{text-align:right}.amp-wp-article-header .amp-wp-meta:first-of-type{text-align:left}.amp-wp-byline amp-img,.amp-wp-byline .amp-wp-author{display:inline-block;vertical-align:middle}.amp-wp-byline amp-img{border:1px solid #0a89c0;border-radius:50%;position:relative;margin-right:6px}.amp-wp-posted-on{text-align:right}.amp-wp-article-featured-image{margin:0 0 1em}.amp-wp-article-featured-image amp-img{margin:0 auto}.amp-wp-article-featured-image.wp-caption .wp-caption-text{margin:0 18px}.amp-wp-article-content{margin:0 16px}.amp-wp-article-content ul,.amp-wp-article-content ol{margin-left:1em}.amp-wp-article-content amp-img{margin:0 auto}.amp-wp-article-content amp-img.alignright{margin:0 0 1em 16px}.amp-wp-article-content amp-img.alignleft{margin:0 16px 1em 0}.wp-caption{padding:0}.wp-caption.alignleft{margin-right:16px}.wp-caption.alignright{margin-left:16px}.wp-caption .wp-caption-text{border-bottom:1px solid #c2c2c2;color:#696969;font-size:.875em;line-height:1.5em;margin:0;padding:.66em 10px .75em}amp-carousel{background:#c2c2c2;margin:0 -16px 1.5em}amp-iframe,amp-youtube,amp-instagram,amp-vine{background:#c2c2c2;margin:0 -16px 1.5em}.amp-wp-article-content amp-carousel amp-img{border:none}amp-carousel>amp-img>img{object-fit:contain}.amp-wp-iframe-placeholder{background:#c2c2c2 url(../../wp-content/plugins/amp/assets/images/placeholder-icon.png) no-repeat center 40%;background-size:48px 48px;min-height:48px}.amp-wp-article-footer .amp-wp-meta{display:block}.amp-wp-tax-category,.amp-wp-tax-tag{color:#696969;font-size:.875em;line-height:1.5em;margin:1.5em 16px}.amp-wp-comments-link{color:#696969;font-size:.875em;line-height:1.5em;text-align:center;margin:2.25em 0 1.5em}.amp-wp-comments-link a{border-style:solid;border-color:#c2c2c2;border-width:1px 1px 2px;border-radius:4px;background-color:transparent;color:#0a89c0;cursor:pointer;display:block;font-size:14px;font-weight:600;line-height:18px;margin:0 auto;max-width:200px;padding:11px 16px;text-decoration:none;width:50%;-webkit-transition:background-color .2s ease;transition:background-color .2s ease}.amp-wp-footer{border-top:1px solid #c2c2c2;margin:calc(1.5em - 1px) 0 0}.amp-wp-footer div{margin:0 auto;max-width:calc(840px - 32px);padding:1.25em 16px 1.25em;position:relative}.amp-wp-footer h2{font-size:1em;line-height:1.375em;margin:0 0 .5em}.amp-wp-footer p{color:#696969;font-size:.8em;line-height:1.5em;margin:0 85px 0 0}.amp-wp-footer a{text-decoration:none}.back-to-top{bottom:1.275em;font-size:.8em;font-weight:600;line-height:2em;position:absolute;right:16px}</style>
</head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="../../index.html">
										<amp-img src="../../wp-content/uploads/2018/08/android-chrome-256x256-120x120.png" width="32" height="32" class="amp-wp-site-icon"></amp-img>
						<span class="amp-site-title">
				Blue Label Labs			</span>
		</a>
	</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">Lessons learned: Getting Android to connect to a WCF service</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://secure.gravatar.com/avatar/2218e5a5d37f457d40fe995c4202edbf?s=24&amp;d=mm&amp;r=g" alt="Bobby Gill" width="24" height="24" layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">Bobby Gill</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2011-04-19T15:17:51+00:00">
		8 years ago	</time>
</div>
	</header>

	<figure class="amp-wp-article-featured-image wp-caption">
	<amp-img src="../../wp-content/uploads/2011/04/icon-1971128_1920-700x700.png" class="attachment-large size-large wp-post-image amp-wp-enforced-sizes" alt="" srcset="https://www.bluelabellabs.com/wp-content/uploads/2011/04/icon-1971128_1920-700x700.png 700w, https://www.bluelabellabs.com/wp-content/uploads/2011/04/icon-1971128_1920-150x150.png 150w, https://www.bluelabellabs.com/wp-content/uploads/2011/04/icon-1971128_1920-250x250.png 250w, https://www.bluelabellabs.com/wp-content/uploads/2011/04/icon-1971128_1920-768x768.png 768w, https://www.bluelabellabs.com/wp-content/uploads/2011/04/icon-1971128_1920-120x120.png 120w" width="700" height="700" layout="intrinsic"></amp-img>	</figure>

	<div class="amp-wp-article-content">
		<p>The initial concept of my mobile application was built on a Windows Phone 7 front end, tied nicely together with a WCF SOAP service on the back. I used “Add Service Reference”, and I pretty much forgot about the fact that I was programming against a web service.</p><p>That was March. This is April.</p><p>In migrating to Android, I’ve come face to face with the beast that is .NET – Java interop. I’ve heard many tales in many night time stories about brave, young, dashing developers like myself being slaughtered by that ugly beast.</p><p>Yet, through 3 weeks of constant battle, flowing tears, and jubilant victories, I smote his ruin upon the mountainside.</p><p>Here are some tips for other dare devils such as myself looking to follow in these large footsteps:</p><p><strong> Lesson 1: Lose the SOAP, get some REST. </strong></p><p>Moving forward to my Android development, I quickly realized that any pretenses I had of using the existing WCF SOAP service with Android needed to be lost. Sure I could use ksoap, but come on folks, learning an entirely new platform is hard enough; there is no way I am going to complicate that by integrating in some 3rd party framework.</p><p>What’s a player to do?</p><p>Simple, wrap the existing Service Contract in a WCF REST-ful Service Contract! The process of wrapping the existing SOAP service with a REST-ish type of interface was quite painless.</p><p>I went from an interface like this:</p><p>[sourcecode language=”csharp”]</p><p>[OperationContract]</p><p>SendChallengeResponse SendChallenge(long fromID,</p><p>long toID,</p><p>string challengeXML,</p><p>out DateTimeOffset dateSent,</p><p>long challengeDefinitionID,</p><p>MessageOptions options,</p><p>AuthnToken authnToken);</p><p>[/sourcecode]</p><p>To:</p><p>[sourcecode language=”csharp”]</p><p>[WebInvoke(UriTemplate = “Challenges/CreateChallenge?fromUserID={fromUserID}&amp;toUserID={toUserID}&amp;challengeDefinitionID={challengeDefinitionID}&amp;message={message}&amp;dateSent={dateSent}&amp;token={authnToken}”,<br>
RequestFormat = WebMessageFormat.Xml, ResponseFormat = WebMessageFormat.Xml)]</p><p>SendChallengeResponse SendChallenge(long fromUserID, long toUserID, long challengeDefinitionID, string message, string dateSent,<br>
string authnToken);</p><p>[/sourcecode]</p><p>DevDiv, you’ve done it again! Converting a SOAP contract to a REST-ful contract in .NET 4.0 took about as long as it did for me to get off the first time a woman touched me “down there”.</p><p>In retrospect, I can see why everybody seems to have such a hard-on for REST (or as I would call it, HTTP web services). It doesn’t require any fancy mucking about with SOAP envelopes. (If you used WCF this wouldn’t be a problem, since WCF does everything but write your application code for you) Now the huge drawback that I see is that I can’t get the same strongly typed client that I do with a WSDL. This, combined with the short-bus XML libraries in Android, make the whole process of serialization a giant pain in the ass.</p><p>But I am sure there are a million Android developers out there who love the fact that they can write their own serialization code. Well I don’t. I’d much rather be out somewhere doing lines off a hooker’s ass than writing a god damned XML serializer.</p><p><strong> Lesson 2: </strong><br><strong> The Android Time class was designed by an intern, either that, or a retard. </strong></p><p>I never thought simply passing Dates between Android and WCF would be such a pain in the ass. Seriously, its 2011, why can’t everybody just agree to at least by default output dates in a common format and support the parsing of that common format across the board?</p><p>Not to mention, Android includes its own concept of a Date which is called a “Time” object. According to the docs, the Time class is “light weight” and “quick”. Come on now, I used to be a Redmond PM. I would drop those words whenever I had no idea what I was talking about (which was frequent). The actual interface of this class looks like it was sketched out by Lindsay Lohan. I’ve been very impressed with the patterns and interface design across the Android platform…except when it comes to Time.</p><p>I’m particularly fond of such gems as:</p><p>[sourcecode language=”csharp”]<br>
void setToNow();</p><p>void Parse(string input);</p><p>[/sourcecode]</p><p>I don ‘t want to be a player hater, but come on, a void method for setting the current time?!Why aren’t these statics? Why does the parse() method not support the same subset of formats that the Java Date class does?</p><p>Anyways, I found the best way to achieve interop between the Android Time class and the .NET DateTimeOffset was to use the RFC 3339 format. Luckily, the Time class includes a parse3339() which will read a DateTimeOffset .NET object formatted according to this string:</p><p>“yyyy’-‘MM’-‘dd’T’HH’:’mm’:’ss’.’fff’Z'”</p><p>Coming from .Android to .NET, I was able to use the format3339() method on the Time class to output a date string that could be parsed with the format specified above with the DateTimeOffset.parse() method.</p><p>But wait, there is a wrinkle. I wanted to standardize on UTC times across the board. Server, client, everything in UTC. However, if one does not instantiate the Time class with the “UTC” timezone in the constructor, then the Time class will output an additional “+000Z” to indicate the time zone, this will cause the DateTimeOffset object to barf attempting to parse it.</p><p><strong> Lesson 3: WCF serialization errors may leave you a “connection reset by peer” error on the Android side </strong></p><p>I had a DataContract that included a type that was non serializable. I didn’t know this. I sat there staring at a “connection reset” error on the Android side even after having debugged fully through the WCF call behind it (with no errors being thrown). It was only after I used Fiddler to execute the command directly was I able to see that WCF was throwing an exception post-call when serializing the object.</p><p>I love Fiddler. What a cool tool. But what’s with the “Object not set to a reference” dialog error that it throws every once in a while? Seriously, Microsoft must have hired the same intern who designed the Time class to be apart of the Fiddler team. Somehow code which I imagine to be equivalent to:</p><p>[sourcecode language=”csharp”]&lt;/pre&gt;<br>
try {<br>
Obj.dosomething();<br>
}</p><p>catch (NullReferenceException e) {<br>
Dialog.Show(e.getMessage());<br>
}</p><p>[/sourcecode]</p><p>Got passed a code review and into a source tree. Displaying a dialog box which tells me there is a NullReferenceException is really not all that more useful than displaying the stack trace itself. In fact, I wish Fiddler did just crash on the Exception, at least I could figure out what was causing it.</p><div class="swp-content-locator"></div>	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: <a href="../../category/how-to-android/index.html" rel="tag">Android</a>, <a href="../../category/development/index.html" rel="tag">Development</a>	</div>

	<div class="amp-wp-meta amp-wp-tax-tag">
		Tags: <a href="../../tag/net-to-android/index.html" rel="tag">.net to android</a>, <a href="../../tag/android/index.html" rel="tag">android</a>, <a href="../../tag/android-time/index.html" rel="tag">android time</a>, <a href="../../tag/dates/index.html" rel="tag">dates</a>, <a href="../../tag/how-to-guides/index.html" rel="tag">how-to-guides</a>, <a href="../../tag/interop/index.html" rel="tag">interop</a>, <a href="../../tag/learning-android/index.html" rel="tag">learning android</a>, <a href="../../tag/soap-vs-rest/index.html" rel="tag">soap vs REST</a>, <a href="../../tag/wcf/index.html" rel="tag">wcf</a>	</div>
		<div class="amp-wp-meta amp-wp-comments-link">
		<a href="../index.html#comments">
			Leave a Comment		</a>
	</div>
	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>Blue Label Labs</h2>
		<p>
			<a href="https://wordpress.org/">
				Powered by WordPress			</a>
		</p>
		<a href="#top" class="back-to-top">Back to top</a>
	</div>
</footer>



</body>

<!-- Mirrored from www.bluelabellabs.com/lessons-learned-getting-android-to-connect-to-a-wcf-service/amp/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 20 Nov 2018 06:31:15 GMT -->
</html>
